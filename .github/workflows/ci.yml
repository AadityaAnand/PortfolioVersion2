name: CI

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  django-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      - name: Django system check
        run: python manage.py check
      - name: Collect static (dry run)
        run: python manage.py collectstatic --noinput --dry-run
      - name: Migrate (sqlite)
        run: python manage.py migrate --noinput
      - name: Smoke test (gunicorn start/stop)
        run: |
          gunicorn portfoliov2.wsgi:application --bind 127.0.0.1:8000 &
          pid=$!
          sleep 5
          curl -f http://127.0.0.1:8000/ || (echo "Home page failed" && exit 1)
          kill $pid || true
*** End Patch